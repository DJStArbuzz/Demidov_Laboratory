#include <iostream>
#include <string>

#include "geometry.h"
#include "glut.h"

using namespace std;

const int N = 30;
const int RAZ = 15;


class Button {
private:
    double x;
    double y;
    double width;
    double height;
    const char* text;
public:
    Button() : x(0), y(0), width(0), height(0), text(nullptr) {};
    Button(double x, double y, double width, double height, const char* text)
        : x(x), y(y), width(width), height(height), text(text) {};

    vector <double> colors;
    void setColor(double first, double second, double third) {
        colors.push_back(first);
        colors.push_back(second);
        colors.push_back(third);
    }

    void drawButton() {

        //Отрисовка кнопки
        glBegin(GL_POLYGON);
        glColor3f(colors[0], colors[1], colors[2]); // Серый цвет
        glVertex2f(x, y);
        glVertex2f(x + width, y);
        glVertex2f(x + width, y + height);
        glVertex2f(x, y + height);
        glEnd();

        glColor3f(0.0f, 0.0f, 0.0f); // Серый цвет
        int textLength = strlen(text);
        float textX = x + 1;
        float textY = y + 1;

        glRasterPos2f(textX, textY);
        for (int i = 0; i < textLength; i++) {
            glutBitmapCharacter(GLUT_BITMAP_8_BY_13, text[i]);
        }
    }

    bool isButtonHovered(Point& najatie) {
        return najatie.x >= this->x && najatie.x <= this->x + this->width &&
            najatie.y >= this->y && najatie.y <= this->y + this->height;
    }

};

vector<pair<int, int>> list = { {0, 0}, {1, 1}, {2,  0} };

/*
    0 - Point, точка на плоскости
    1 - Line, прямая
    2 - Polygon, многоугольник
    3 - Ellipse, эллипс
    4 - Circle, круг
    5 - Rectangle, прямоугольник
    6 - Square, квадрат
    7 - Triangle, треугольник
*/
vector<Point> pointList = { Point(1.0, 1.0), Point(2.9, 2.1) };
vector<Line> lineList = { Line(Point(1.0, 1.0), Point(2.0, 2.0)), Line(5, 5) };
vector<Shape> polygonList = { Polygon({Point(1.0, 2.0), Point(3.0, 3.0), Point(1.0, 3.0)})};
vector<Shape> ellipseList = { Ellipse(Point(1.0, 2.0), Point(2.0, 5.0), 5) };
vector<Shape> circleList = { Circle(Point(1.0, 6.0), 5) };
vector<Shape> rectangleList;
vector<Shape> squareList;
vector<Shape> triangleList;

int editing_number = -1;

enum MenuState
{
    MAIN,
    CREATION,
    POLYGON,
    ELLIPSE,
    CIRCLE,
    RECTANGLE,
    SQUARE,
    TRIANGLE,
    EDIT
};

MenuState currentMenuState = MAIN;
//Кнопки меню
Button bPolygon(31, 25, 12, 4, "Polygon");
Button bEllipse(31, 20, 12, 4, "Ellipse");
Button bCircle(31, 15, 12, 4, "Circle");
Button bRectangle(31, 10, 12, 4, "Rectangle");
Button bTriangle(31, 5, 12, 4, "Triangle");
Button bSquare(31, 0, 12, 4, "Square");
Button to_Main_Menu(31, -5, 12, 4, "To start");

Button Create(31, -10, 12, 4, "Create");
Button Edit(31, -15, 12, 4, "Edit");


void instruction() {
    cout << "Сначала указываем на массив с фигурами\n";
    cout << "Потом Указываем на номер в массиве\n";
    cout << "1 - Создать элемент\n";
    cout << "2 - Удалить элемент\n";
    cout << "3 - Периметр\n";
    cout << "4 - Площадь\n";
    cout << "5 - Равенство с фигурой\n";
    cout << "6 - Подобие с фигурой\n";
    cout << "7 - Нахождение в фигуре\n";
    cout << "8 - Поворот на угол\n";
    cout << "9 - Симметрия\n";
    cout << "9 - Гомотетия\n";
    cout << "-----------------------------\n";
}

void init() {
    glClearColor(0.0, 0.0, 1.0, 1.0);
    glMatrixMode(GL_PROJECTION);
    glLoadIdentity();
    glOrtho(-N, N + RAZ, -N, N, -1.0, 1.0);
}


void drawMenu() {
    bCreate.setColor(0.9, 0.0, 0.5);
    bDelete.setColor(0.9, 0.0, 0.5);
    bEdit.setColor(0.9, 0.0, 0.5);
    bNext.setColor(0.9, 0.0, 0.5);
    bPreview.setColor(0.9, 0.0, 0.5);
    bInstruction.setColor(0.9, 0.0, 0.5);


    bCreate.drawButton();
    bDelete.drawButton();
    bEdit.drawButton();
    bNext.drawButton();
    bPreview.drawButton();
    bInstruction.drawButton();
}

void drawGrid() {
    glColor3f(0.0, 0.0, 0.0);
    glLineWidth(1.0);
    glBegin(GL_LINES);
    for (int i = -N; i <= N; i++) {
        glVertex2f(i, -N);
        glVertex2f(i, N);
        glVertex2f(-N, i);
        glVertex2f(N, i);
    }
    glEnd();
}


void drawAxes() {
    glBegin(GL_QUADS);
    glVertex2f(-N, -N);
    glVertex2f(-N, N);
    glVertex2f(N, N);
    glVertex2f(N, -N);
    glEnd();

    glColor3f(1.0, 0.0, 0.0);
    glLineWidth(4.0);
    glBegin(GL_LINES);
    glVertex2f(-N, 0);
    glVertex2f(N, 0);
    glVertex2f(0, -N);
    glVertex2f(0, N);
    glEnd();
}

void mouseClickHandler(int button, int state, int x, int y) {
    setlocale(LC_ALL, "rus");
    double X = (x - N + RAZ) * 2, Y = N - (y * 2);

    Point najatie(X, Y);
    if (button == GLUT_LEFT_BUTTON && state == GLUT_DOWN)
    {
        switch (currentMenuState)
        {
            case 
        }
    }
}



void display() {
    glClear(GL_COLOR_BUFFER_BIT);
    drawAxes();
    drawMenu();
    drawGrid();

    glColor3f(1.0, 1.0, 1.0);

    glFlush();

    glutSwapBuffers();
}

int main(int argc, char** argv) {
    setlocale(LC_ALL, "RUS");
    instruction();
    glutInit(&argc, argv);
    glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGB);
    glutInitWindowSize(1000, 1000);
    glutCreateWindow("Лабораторная работа №10, вариант №1");

    init();

    glutDisplayFunc(display);
    glutKeyboardFunc(mouseClickHandler);

    glutMainLoop();

    return 0;
}
